               .deffile adi_defs__0.asm
               .deffile ddi_defs__0.asm
               .deffile reg_defs__0.asm
               .deffile sce_defs__0.asm
               
               ; Number of supported tasks
               .define TASK_COUNT      1
               
               ; Resource-specified definitions, if any
               ; (None)
               
               
               .segment begin "Framework"
               
               
               VectorTable:
0000 ---- 1408                         jsr         PowerUp
0001 ---- 040c                         jmp         TaskCtrlReqVector
0002 ---- 1408                         jsr         PowerUp
0003 ---- 0434                         jmp         AonRtcCh2Vector
0004 ---- 1408                         jsr         PowerUp
0005 ---- 044f                         jmp         Event0Vector
0006 ---- 1408                         jsr         PowerUp
0007 ---- 0455                         jmp         TaskAlertAckVector
               
               
               
               
               PowerUp:
                                       ; Deassert the power-down request
0008 ---- 4436                         iobclr      #0, [#IOP_WUC_PWRDWNREQ]
               
                                       ; Wait for it to take effect
0009 ---- 2437 /waitForPdAck:          iobtst      #0, [#IOP_WUC_PWRDWNACK]
000a ---- aefe                         biob1       /waitForPdAck
               
               FwEmptyFunc:            ; Done
000b ---- adb7                         rts
               
               
               
               
               TaskCtrlReqVector:
                                       ; Clear the vector flag
000c ---- 6442                         iobset      #0, [#IOP_EVCTL_VECFLAGSCLR]
               
                                       ; For each task ...
000d ---- 7000                         ld          R7, #0
               /loop:
                                           ; Save the task ID
000e ---- 7c75                             st          R7, [#fwCtrlInt/taskId]
               
                                           ; Handle initialize request, if any
000f ---- 687c                             ld          R6, [#fwCtrlExt/bvTaskInitializeReq]
0010 ---- 0070                             ld          R0, #pFwTaskInitializeFuncTable
0011 ---- 142d                             jsr         /handleReq
               
                                           ; Handle execute request, if any
0012 ---- 687d                             ld          R6, [#fwCtrlExt/bvTaskExecuteReq]
0013 ---- 0071                             ld          R0, #pFwTaskExecuteFuncTable
0014 ---- 142d                             jsr         /handleReq
               
                                           ; Handle terminate request, if any
0015 ---- 687e                             ld          R6, [#fwCtrlExt/bvTaskTerminateReq]
0016 ---- 0072                             ld          R0, #pFwTaskTerminateFuncTable
0017 ---- 142d                             jsr         /handleReq
               
                                           ; Move on to the next task
0018 ---- 7875                             ld          R7, [#fwCtrlInt/taskId]
0019 ---- f801                             add         R7, #1
               
001a ---- fa01                         cmp         R7, #TASK_COUNT
001b ---- bef2                         bneq        /loop
               
                                       ; Update which tasks are ...
001c ---- 787a                         ld          R7, [#fwCtrlExt/bvActiveTasks]
                                       ; ... currently active ...
001d ---- 687c                         ld          R6, [#fwCtrlExt/bvTaskInitializeReq]
001e ---- fd0e                         or          R7, R6
                                       ; ... and inactive ...
001f ---- 687e                         ld          R6, [#fwCtrlExt/bvTaskTerminateReq]
0020 ---- ed92                         inv         R6
0021 ---- fd06                         and         R7, R6
0022 ---- 7c7a                         st          R7, [#fwCtrlExt/bvActiveTasks]
               
                                       ; Has the run-time logging application requested locked struct access?
0023 ---- 7879                         ld          R7, [#fwCtrlInt/rtlStructLockReq]
0024 ---- fa01                         cmp         R7, #1
0025 ---- be05                         bneq        /noRtlStructWriteReq
               
                                           ; Signalize that we're ready
0026 ---- 7002                             ld          R7, #2
0027 ---- 7c79                             st          R7, [#fwCtrlInt/rtlStructLockReq]
               
               /waitRtlStructWriteLoop:    ; Wait until the run-time logging application is done
0028 ---- 7879                             ld          R7, [#fwCtrlInt/rtlStructLockReq]
0029 ---- fa00                             cmp         R7, #0
002a ---- befd                             bneq        /waitRtlStructWriteLoop
               /noRtlStructWriteReq:
                                       ; We're READY for another request
002b ---- 642d                         iobset      #IOB_EVCTL_SWEV_READY, [#IOP_EVCTL_SWEVSET]
               
                                       ; Generate an ALERT interrupt if needed before powering back down
002c ---- 0458                         jmp         GenAlertInterrupt;
               
               /handleReq:
                                       ; Restore the task ID, and load the function pointer (here to avoid pipeline hazard)
002d ---- 7875                         ld          R7, [#fwCtrlInt/taskId]
002e ---- 8f1f                         ld          R0, [R7+R0]
               
                                       ; Skip this request?
002f ---- ed8f                         lsr         R6, R7
0030 ---- ec01                         tst         R6, #0x0001
0031 ---- be01                         bnz         /noSkip
0032 ---- adb7                             rts
               /noSkip:
                                       ; Make the call by jump, with return (rts) in the "called" function
0033 ---- 8db7                         jmp         R0
               
               
               
               
               AonRtcCh2Vector:
                                       ; Start clearing the RTC event
0034 ---- 6630                         iobset      #IOB_WUC_WUEV_RTC, [#IOP_WUC_WUEVCLR]
               
                                       ; Clear the vector flag
0035 ---- 6542                         iobset      #1, [#IOP_EVCTL_VECFLAGSCLR]
               
                                       ; For each task (R0 is the current task ID) ...
0036 ---- 0000                         ld          R0, #0
               /loop:
                                           ; ... that is active ...
0037 ---- 187a                             ld          R1, [#fwCtrlExt/bvActiveTasks]
0038 ---- 9d88                             lsr         R1, R0
0039 ---- 9c01                             tst         R1, #0x0001
003a ---- b60d                             bz          /skip
               
                                               ; Fetch number of RTC intervals until next execution
003b ---- 106f                                 ld          R1, #pFwTaskExecuteScheduleTable
003c ---- af19                                 ld          R2, [R1+R0]
               
                                               ; If not already 0, decrement and store. If then 0 ...
003d ---- aa00                                 cmp         R2, #0
003e ---- b609                                 beq         /skip
003f ---- a8ff                                 add         R2, #-1
0040 ---- af39                                 st          R2, [R1+R0]
0041 ---- be06                                 bnz         /skip
               
                                                   ; ... execute the task
0042 ---- 0c75                                     st          R0, [#fwCtrlInt/taskId]
0043 ---- 8871                                     add         R0, #pFwTaskExecuteFuncTable
0044 ---- 8f08                                     ld          R0, [R0]
                                                   ; Insert NOP to avoid pipeline hazard
0045 ---- fd47                                     nop
0046 ---- 9db7                                     jsr         R0
0047 ---- 0875                                     ld          R0, [#fwCtrlInt/taskId]
               /skip:
                                           ; Move on to the next task
0048 ---- 8801                             add         R0, #1
               
0049 ---- 8a01                         cmp         R0, #TASK_COUNT
004a ---- beec                         bneq        /loop
               
                                       ; Wait for the ACK event to be cleared
004b ---- 262f /waitOnRtcClearing:     iobtst      #IOB_WUC_WUEV_RTC, [#IOP_WUC_WUEVFLAGS]
004c ---- aefe                         biob1       /waitOnRtcClearing
004d ---- 4630                         iobclr      #IOB_WUC_WUEV_RTC, [#IOP_WUC_WUEVCLR]
               
                                       ; Generate an ALERT interrupt if needed
004e ---- 0458                         jmp         GenAlertInterrupt;
               
               
               
               
               Event0Vector:
                                       ; Disable and clear the vector flag
004f ---- 5527                         iobclr      #IOB_EVCTL_VECCFG1_VEC2_EN, [#IOP_EVCTL_VECCFG1]
0050 ---- 6642                         iobset      #2, [#IOP_EVCTL_VECFLAGSCLR]
               
                                       ; Set the task ID
0051 ---- 0000                         ld          R0, #0
0052 ---- 0c75                         st          R0, [#fwCtrlInt/taskId]
               
                                       ; Jump to the event task code
0053 ---- 140b                         jsr         FwEmptyFunc
               
                                       ; Generate an ALERT interrupt if needed
0054 ---- 0458                         jmp         GenAlertInterrupt;
               
               
               
               
               TaskAlertAckVector:
                                       ; Clear the vector flag
0055 ---- 6742                         iobset      #3, [#IOP_EVCTL_VECFLAGSCLR]
               
                                       ; Re-enable generation of ALERT interrupts
0056 ---- 03ff                         ld          R0, #-1
0057 ---- 0c77                         st          R0, [#fwCtrlInt/alertGenMask]
               
                                       ; Fall through to GenAlertInterrupt to generate another ALERT interrupt if needed
               
               
               
               
               GenAlertInterrupt:
                                       ; Do we have any ALERT-generating flags pending?
0058 ---- 7876                         ld          R7, [#fwCtrlInt/bvTaskIoAlert]
               
                                       ; Skip if the last I/O ALERT interrupt has not been acknowledged
0059 ---- 6877                         ld          R6, [#fwCtrlInt/alertGenMask]
005a ---- ed37                         tst         R6, R7
005b ---- b605                         bz          /skipAlertGen
               
                                           ; Transfer I/O flags from internal to external
005c ---- 0000                             ld          R0, #0
005d ---- 0c76                             st          R0, [#fwCtrlInt/bvTaskIoAlert]
005e ---- 7c7b                             st          R7, [#fwCtrlExt/bvTaskIoAlert]
               
                                           ; Generate the ALERT interrupt, and clear the generation mask
005f ---- 652d                             iobset      #IOB_EVCTL_SWEV_ALERT, [#IOP_EVCTL_SWEVSET]
0060 ---- 0c77                             st          R0, [#fwCtrlInt/alertGenMask]
               /skipAlertGen:
                                       ; Fall through to PowerDown ...
               
               
               
               
               PowerDown:
                                       ; If there are no unacknowledged ALERTs and no vectors pending ...
0061 ---- 7877                         ld          R7, [#fwCtrlInt/alertGenMask]
0062 ---- 6878                         ld          R6, [#fwCtrlInt/alertCanPdAuxMask]
0063 ---- fd0e                         or          R7, R6
0064 ---- f801                         add         R7, #1 ; 0xFFFF -> 0x0000
0065 ---- e92b                         in          R6, [#IOP_EVCTL_VECFLAGS]
0066 ---- fd0e                         or          R7, R6
0067 ---- be01                         bnz         /noPowerDown
               
                                           ; Assert the power-down request. We'll make sure that it has taken effect
                                           ; or been completely ignored when waking up again
0068 ---- 6436                             iobset      #0, [#IOP_WUC_PWRDWNREQ]
               /noPowerDown:
                                       ; Sleep until the next event
0069 ---- bdb7 sleepInstr:             sleep
               
               
               
               
006a ---- 241a AdiDdiAcquire:          iobtst      #0, [#IOP_SMPH_SMPH0]
006b ---- a6fe                         biob0       AdiDdiAcquire
006c ---- adb7                         rts
               
006d ---- 641a AdiDdiRelease:          iobset      #0, [#IOP_SMPH_SMPH0]
006e ---- adb7                         rts
               
               
               
               
               ; RTC ticks until next execution, one word for each task
               pFwTaskExecuteScheduleTable:
006f ---- 0000                         dw          #0
               
               ; Task code function pointers for each task code block, one word for each task
               pFwTaskInitializeFuncTable:
0070 ---- 00cc                         dw          #analyseIk/initialize
               pFwTaskExecuteFuncTable:
0071 ---- 00ed                         dw          #analyseIk/execute
               pFwTaskTerminateFuncTable:
0072 ---- 03dd                         dw          #analyseIk/terminate
               
               ; Run-time logging log requests and masks, one bit for each struct, one word for each task
               pRtlTaskLogReqTable:
0073 ---- 0000                         dw          #0x0000
               pRtlTaskLogMaskTable:
0074 ---- 0000                         dw          #0x0000
               
               
               ; Internal control data
               fwCtrlInt:
0075 ---- 0000 /taskId:                dw          #0      ; ID of the currently running task
0076 ---- 0000 /bvTaskIoAlert:         dw          #0x0000 ; LSB = Normal data exchange, MSB = Overflow or underflow
0077 ---- ffff /alertGenMask:          dw          #0xFFFF ; Can generate an ALERT interrupt now? (0xFFFF = yes, 0x0000 = no)
0078 ---- 0000 /alertCanPdAuxMask:     dw          #0x0000 ; Can power down AUX domain after ALERT interrupt generation? (0xFFFF = yes, 0x0000 = no)
0079 ---- 0000 /rtlStructLockReq:      dw          #0x0000 ; Run-time logging struct lock request (0=idle -> 1=requested -> 2=ready -> access -> 0=idle)
               
               ; External control data, shared with the driver
               fwCtrlExt:
007a ---- 0000 /bvActiveTasks:         dw          #0x0000 ; Indicates which tasks are currently active
007b ---- 0000 /bvTaskIoAlert:         dw          #0x0000 ; LSB = Normal data exchange, MSB = Overflow or underflow
007c ---- 0000 /bvTaskInitializeReq:   dw          #0x0000 ; Requests tasks to start
007d ---- 0000 /bvTaskExecuteReq:      dw          #0x0000 ; Requests tasks to execute once immediately
007e ---- 0000 /bvTaskTerminateReq:    dw          #0x0000 ; Requests tasks to stop
               
               
               .segment end "Framework"
               
               
               fwTaskDataStructures:
               .segment begin "Task: AnalyseIK"
               analyseIk/cfg:
               analyseIk/cfg/CntMinusOne:
007f ---- 0000                         dw          #0
               analyseIk/cfg/Uacc:
0080 ---- 0000                         dw          #0
               analyseIk/cfg/Uledi:
0081 ---- 0000                         dw          #0
               analyseIk/cfg/adcWindowHigh:
0082 ---- 0000                         dw          #0
               analyseIk/cfg/adcWindowLow:
0083 ---- 0000                         dw          #0
               analyseIk/cfg/dUled:
0084 ---- 0000                         dw          #0
               analyseIk/cfg/flags:
0085 ---- 0000                         dw          #0
               analyseIk/input:
               analyseIk/input/count:
0086 ---- 0000                         dw          #0
               analyseIk/input/isArmed:
0087 ---- 0000                         dw          #0
               analyseIk/input/isLogMode:
0088 ---- 0000                         dw          #0
               analyseIk/input/isTestMode:
0089 ---- 0000                         dw          #0
               analyseIk/output:
               analyseIk/output/LightThrCounter10:
008a ---- 0000                         dw          #0
               analyseIk/output/PirPulseCounter:
008b ---- 0000                         dw          #0
               analyseIk/output/Uledi:
008c ---- 0000                         dw          #0
               analyseIk/output/Uph:
008d ---- 0000                         dw          #0
               analyseIk/output/Upirav:
008e ---- 0000                         dw          #0
               analyseIk/output/Upiri:
008f ---- 0000                         dw          #0
               analyseIk/output/Upl:
0090 ---- 0000                         dw          #0
               analyseIk/output/dUled:
0091 ---- 0000                         dw          #0
               analyseIk/state:
               analyseIk/state/Downtimer:
0092 ---- 0000                         dw          #0
               analyseIk/state/DowntimerRun:
0093 ---- 0000                         dw          #0
               analyseIk/state/IKstate:
0094 ---- 0000                         dw          #0
               analyseIk/state/LightThrCounter:
0095 ---- 0000                         dw          #0
               analyseIk/state/PirAveragingSamples:
0096 ---- 0000                         dw          #0
               analyseIk/state/PirOutOfPipe:
0097 ---- 0000                         dw          #0
               analyseIk/state/PirPulseCounter:
0098 ---- 0000                         dw          #0
               analyseIk/state/PirPulsePresense:
0099 ---- 0000                         dw          #0
               analyseIk/state/Uacch:
009a ---- 0000                         dw          #0
               analyseIk/state/Uaccl:
009b ---- 0000                         dw          #0
               analyseIk/state/Ubat:
009c ---- 0000                         dw          #0
               analyseIk/state/Ucp:
009d ---- 0000                         dw          #0
               analyseIk/state/Uledi:
009e ---- 0000                         dw          #0
               analyseIk/state/Uledidx:
009f ---- 0000                         dw          #0
               analyseIk/state/Uledmax:
00a0 ---- 0000                         dw          #0
               analyseIk/state/Uledmin:
00a1 ---- 0000                         dw          #0
               analyseIk/state/Uph:
00a2 ---- 0000                         dw          #0
               analyseIk/state/Upiri:
00a3 ---- 0000                         dw          #0
               analyseIk/state/Upiri1:
00a4 ---- 0000                         dw          #0
               analyseIk/state/Upiri2:
00a5 ---- 0000                         dw          #0
               analyseIk/state/Upl:
00a6 ---- 0000                         dw          #0
               analyseIk/state/Ut:
00a7 ---- 0000                         dw          #0
               analyseIk/state/aUled:
00a8 ---- 0000                         dw          #0
00a9 ---- 0000                         dw          #0
00aa ---- 0000                         dw          #0
00ab ---- 0000                         dw          #0
00ac ---- 0000                         dw          #0
00ad ---- 0000                         dw          #0
00ae ---- 0000                         dw          #0
00af ---- 0000                         dw          #0
00b0 ---- 0000                         dw          #0
00b1 ---- 0000                         dw          #0
00b2 ---- 0000                         dw          #0
00b3 ---- 0000                         dw          #0
00b4 ---- 0000                         dw          #0
00b5 ---- 0000                         dw          #0
00b6 ---- 0000                         dw          #0
00b7 ---- 0000                         dw          #0
               analyseIk/state/absdU:
00b8 ---- 0000                         dw          #0
               analyseIk/state/absdU1:
00b9 ---- 0000                         dw          #0
               analyseIk/state/adcdowntimer:
00ba ---- 0000                         dw          #0
               analyseIk/state/alarmdowntimer:
00bb ---- 0000                         dw          #0
               analyseIk/state/alarmdowntimerrun:
00bc ---- 0000                         dw          #0
               analyseIk/state/dUled:
00bd ---- 0000                         dw          #0
               analyseIk/state/deltaU:
00be ---- 0000                         dw          #0
               analyseIk/state/deltaU1:
00bf ---- 0000                         dw          #0
               analyseIk/state/idledowntimer:
00c0 ---- 0000                         dw          #0
               analyseIk/state/idledowntimerrun:
00c1 ---- 0000                         dw          #0
               analyseIk/state/lightdowntimer:
00c2 ---- 0000                         dw          #0
               analyseIk/state/lightdowntimerrun:
00c3 ---- 0000                         dw          #0
               analyseIk/state/maxUh:
00c4 ---- 0000                         dw          #0
               analyseIk/state/maxUl:
00c5 ---- 0000                         dw          #0
               analyseIk/state/maxslope:
00c6 ---- 0000                         dw          #0
               analyseIk/state/slope1:
00c7 ---- 0000                         dw          #0
               analyseIk/state/slope2:
00c8 ---- 0000                         dw          #0
               analyseIk/state/state:
00c9 ---- 0000                         dw          #0
               analyseIk/state/thrdowntimer:
00ca ---- 0000                         dw          #0
               analyseIk/state/thrdowntimerrun:
00cb ---- 0000                         dw          #0
               .segment end "Task: AnalyseIK"
               
               
               .segment begin "Task: AnalyseIK"
               analyseIk/initialize:
               ;? //U16 t5S = 250;     //5S start time (250 for 20 ms step)
               ;? U16 powerOff = 0;
00cc ---- 0000                         ld          R0, #0
               ;? //U16 powerOn = 1;
               ;? //U16 waitIr = 2;
               ;? //U16 common = 3;
               ;? 
               ;? // Select ADC input
               ;? adcSelectGpioInput(AUXIO_A_IR_OUT);
00cd ---- 7002                         ld          R7, #2
00ce ---- 17de                         jsr         AdccompbSelectGpioInput
               ;? 
               ;? gpioSetOutput(AUXIO_O_PIR_OFF);
00cf ---- 640f                         iobset      #(8 & 0x7), [#(IOP_AIODIO0_GPIODOUT + (8 >> 3))]
               ;? 
               ;? state.PirPulseCounter = 0;
00d0 ---- 6000                         ld          R6, #0
00d1 ---- 6c98                         st          R6, [#analyseIk/state/PirPulseCounter]
               ;? state.Ucp = 2000;
00d2 8607 63d0                         ld          R6, #2000
00d4 ---- 6c9d                         st          R6, [#analyseIk/state/Ucp]
               ;? state.Uph = state.Ucp + PIR_THRESHOLD;
00d5 ---- 689d                         ld          R6, [#analyseIk/state/Ucp]
00d6 8600 e8ac                         add         R6, #172
00d8 ---- 6ca2                         st          R6, [#analyseIk/state/Uph]
               ;? state.Upl = state.Ucp - PIR_THRESHOLD;
00d9 ---- 689d                         ld          R6, [#analyseIk/state/Ucp]
00da 86ff e854                         add         R6, #-172
00dc ---- 6ca6                         st          R6, [#analyseIk/state/Upl]
               ;? cfg.adcWindowHigh = state.Ucp + PIR_NOISE_THRESHOLD;
00dd ---- 689d                         ld          R6, [#analyseIk/state/Ucp]
00de ---- e839                         add         R6, #57
00df ---- 6c82                         st          R6, [#analyseIk/cfg/adcWindowHigh]
               ;? cfg.adcWindowLow = state.Ucp - PIR_NOISE_THRESHOLD;
00e0 ---- 689d                         ld          R6, [#analyseIk/state/Ucp]
00e1 ---- e8c7                         add         R6, #-57
00e2 ---- 6c83                         st          R6, [#analyseIk/cfg/adcWindowLow]
               ;? 
               ;? state.adcdowntimer = PERIOD_1S;
00e3 ---- 6032                         ld          R6, #50
00e4 ---- 6cba                         st          R6, [#analyseIk/state/adcdowntimer]
               ;? state.Downtimer = 0;
00e5 ---- 6000                         ld          R6, #0
00e6 ---- 6c92                         st          R6, [#analyseIk/state/Downtimer]
               ;? state.DowntimerRun = 0;
00e7 ---- 6000                         ld          R6, #0
00e8 ---- 6c93                         st          R6, [#analyseIk/state/DowntimerRun]
               ;? state.state = powerOff;
00e9 ---- 0cc9                         st          R0, [#analyseIk/state/state]
               ;? 
               ;? //scifStartRtcTicks(0x00010000, 0x00002000);
               ;? 
               ;? // Schedule the first execution
               ;? fwScheduleTask(1);
00ea ---- 0001                         ld          R0, #1
00eb ---- 0c6f                         st          R0, [#(pFwTaskExecuteScheduleTable + 0)]
               analyseIk/initializeDone:
00ec ---- adb7                         rts         
                                       
                                       
                                       
                                       
               analyseIk/execute:
               ;? macro max(maxval, val1, val2) {
               ;?     if (val1 >= val2) {
               ;?         maxval = val1;
               ;?     } else {
               ;?         maxval = val2;
               ;?     }
               ;? }
               ;? 
               ;? U16 powerOff = 0;
00ed ---- 0000                         ld          R0, #0
               ;? U16 powerOn = 1;
00ee ---- 1001                         ld          R1, #1
               ;? U16 waitIr = 2;
00ef ---- 2002                         ld          R2, #2
               ;? U16 common = 3;
00f0 ---- 3003                         ld          R3, #3
               ;? 
               ;? U16 l_Uph = 0;
               ;? U16 l_Upl = 0;
               ;? U16 PirDynamicThresh = 0;
               ;? U16 condition = 0;
               ;? S16 n = 0;
               ;? 
               ;? l_Uph = state.Ucp + PIR_THRESHOLD;
00f1 ---- 489d                         ld          R4, [#analyseIk/state/Ucp]
00f2 8600 c8ac                         add         R4, #172
               ;? l_Upl = state.Ucp - PIR_THRESHOLD;
00f4 ---- 589d                         ld          R5, [#analyseIk/state/Ucp]
00f5 86ff d854                         add         R5, #-172
               ;? 
               ;? if (input.isArmed != 0) {
00f7 ---- 6887                         ld          R6, [#analyseIk/input/isArmed]
00f8 ---- ea00                         cmp         R6, #0
00f9 ---- b60f                         beq         /id0261
               ;?     if (state.state == powerOff) {
00fa ---- 68c9                             ld          R6, [#analyseIk/state/state]
00fb ---- ed28                             cmp         R6, R0
00fc ---- be0b                             bneq        /id0264
               ;?         state.Downtimer = PERIOD_5S;
00fd ---- 00fa                                 ld          R0, #250
00fe ---- 0c92                                 st          R0, [#analyseIk/state/Downtimer]
               ;?         state.DowntimerRun = 1;
00ff ---- 0001                                 ld          R0, #1
0100 ---- 0c93                                 st          R0, [#analyseIk/state/DowntimerRun]
               ;?         state.state = powerOn;
0101 ---- 1cc9                                 st          R1, [#analyseIk/state/state]
               ;?         state.Uacch = 0;
0102 ---- 0000                                 ld          R0, #0
0103 ---- 0c9a                                 st          R0, [#analyseIk/state/Uacch]
               ;?         state.Uaccl = 0;
0104 ---- 0000                                 ld          R0, #0
0105 ---- 0c9b                                 st          R0, [#analyseIk/state/Uaccl]
               ;?         state.PirAveragingSamples = PIR_AVERAGING_TIME;
0106 ---- 0080                                 ld          R0, #128
0107 ---- 0c96                                 st          R0, [#analyseIk/state/PirAveragingSamples]
               ;?     }
               /id0264:
               ;? } else {
0108 ---- 0522                         jmp         /id0263
               /id0261:
               ;?     if (state.state != powerOff) {
0109 ---- 68c9                             ld          R6, [#analyseIk/state/state]
010a ---- ed28                             cmp         R6, R0
010b ---- b616                             beq         /id0273
               ;?         gpioSetOutput(AUXIO_O_PIR_OFF);
010c ---- 640f                                 iobset      #(8 & 0x7), [#(IOP_AIODIO0_GPIODOUT + (8 >> 3))]
               ;?         state.state = powerOff;
010d ---- 0cc9                                 st          R0, [#analyseIk/state/state]
               ;?         state.PirPulseCounter = 0;
010e ---- 0000                                 ld          R0, #0
010f ---- 0c98                                 st          R0, [#analyseIk/state/PirPulseCounter]
               ;?         state.PirPulsePresense = 0;
0110 ---- 0000                                 ld          R0, #0
0111 ---- 0c99                                 st          R0, [#analyseIk/state/PirPulsePresense]
               ;?         state.PirOutOfPipe = 0;
0112 ---- 0000                                 ld          R0, #0
0113 ---- 0c97                                 st          R0, [#analyseIk/state/PirOutOfPipe]
               ;?         cfg.CntMinusOne = 0;
0114 ---- 0000                                 ld          R0, #0
0115 ---- 0c7f                                 st          R0, [#analyseIk/cfg/CntMinusOne]
               ;?         state.alarmdowntimerrun = 0;
0116 ---- 0000                                 ld          R0, #0
0117 ---- 0cbc                                 st          R0, [#analyseIk/state/alarmdowntimerrun]
               ;?         state.idledowntimerrun = 0;
0118 ---- 0000                                 ld          R0, #0
0119 ---- 0cc1                                 st          R0, [#analyseIk/state/idledowntimerrun]
               ;?         state.lightdowntimerrun = 0;
011a ---- 0000                                 ld          R0, #0
011b ---- 0cc3                                 st          R0, [#analyseIk/state/lightdowntimerrun]
               ;?         state.thrdowntimerrun = 0;
011c ---- 0000                                 ld          R0, #0
011d ---- 0ccb                                 st          R0, [#analyseIk/state/thrdowntimerrun]
               ;?         state.IKstate &= ~AP_IK_ALARM_FLAG;
011e ---- 0894                                 ld          R0, [#analyseIk/state/IKstate]
011f 86ff 80fd                                 and         R0, #65533
0121 ---- 0c94                                 st          R0, [#analyseIk/state/IKstate]
               ;?     }
               /id0273:
               ;? }
               /id0263:
               ;? 
               ;? if (state.DowntimerRun != 0) {
0122 ---- 0893                         ld          R0, [#analyseIk/state/DowntimerRun]
0123 ---- 8a00                         cmp         R0, #0
0124 ---- b608                         beq         /id0287
               ;?     state.Downtimer -= 1;
0125 ---- 0892                             ld          R0, [#analyseIk/state/Downtimer]
0126 ---- 88ff                             add         R0, #-1
0127 ---- 0c92                             st          R0, [#analyseIk/state/Downtimer]
               ;?     if (state.Downtimer == 0) {
0128 ---- 0892                             ld          R0, [#analyseIk/state/Downtimer]
0129 ---- 8a00                             cmp         R0, #0
012a ---- be02                             bneq        /id0291
               ;?         state.DowntimerRun = 0;
012b ---- 0000                                 ld          R0, #0
012c ---- 0c93                                 st          R0, [#analyseIk/state/DowntimerRun]
               ;?     }
               /id0291:
               ;? }
               /id0287:
               ;? 
               ;? adcEnableSync(ADC_REF_VDDS_REL, ADC_SAMPLE_TIME_21P3_US, ADC_TRIGGER_MANUAL);
012d ---- 7009                         ld          R7, #((8 | (((6 < 6) & (!8)) * ADI16_ADCREF_REF_ON_IDLE)) | ADI16_ADCREF_EN)
012e ---- 146a                         jsr         AdiDdiAcquire
012f ---- fb4d                         out         R7, [#IOP_ADISET_ADCREF]
0130 8609 7101                         ld          R7, #((9 << IOB_ANAIF_ADCCTL_START_SRC) | 0x0001)
0132 ---- 6431                         iobset      #IOB_WUC_ADCCLKCTL_REQ, [#IOP_WUC_ADCCLKCTL]
               /id0295:
0133 ---- 2531                         iobtst      #IOB_WUC_ADCCLKCTL_ACK, [#IOP_WUC_ADCCLKCTL]
0134 ---- a6fe                         biob0       /id0295
0135 ---- fb00                         out         R7, [#IOP_ANAIF_ADCCTL]
0136 ---- 7078                         ld          R7, #BV_ADI16_ADC_SMPL_CYCLE_EXP
0137 ---- fb54                         out         R7, [#IOP_ADICLR_ADC]
0138 ---- 7030                         ld          R7, #(6 << BI_ADI16_ADC_SMPL_CYCLE_EXP)
0139 ---- fb4c                         out         R7, [#IOP_ADISET_ADC]
013a ---- 7003                         ld          R7, #(ADI16_ADC_EN | ADI16_ADC_RESET_N)
013b ---- fb4c                         out         R7, [#IOP_ADISET_ADC]
013c ---- fd47                         nop         
013d ---- fb4c                         out         R7, [#IOP_ADISET_ADC]
013e ---- 146d                         jsr         AdiDdiRelease
               ;? adcSelectGpioInput(AUXIO_A_IR_OUT);
013f ---- 7002                         ld          R7, #2
0140 ---- 17de                         jsr         AdccompbSelectGpioInput
               ;? adcGenManualTrigger();
0141 ---- 6403                         iobset      #0, [#IOP_ANAIF_ADCTRIG]
               ;? adcReadFifo(output.Upiri);
0142 ---- 001f                         ld          R0, #EVCTL_SCEEVSEL_ADC_FIFO_NOT_EMPTY
0143 ---- 8b2c                         out         R0, [#IOP_EVCTL_SCEWEVSEL]
0144 ---- fdb1                         wev1        #WEVSEL_PROG
0145 ---- 8902                         in          R0, [#IOP_ANAIF_ADCFIFO]
0146 ---- 0c8f                         st          R0, [#analyseIk/output/Upiri]
               ;? 
               ;? adcSelectGpioInput(AUXIO_A_LED_RED_AIN);
0147 ---- 7005                         ld          R7, #5
0148 ---- 17de                         jsr         AdccompbSelectGpioInput
               ;? adcGenManualTrigger();
0149 ---- 6403                         iobset      #0, [#IOP_ANAIF_ADCTRIG]
               ;? adcReadFifo(state.Uledi);
014a ---- 001f                         ld          R0, #EVCTL_SCEEVSEL_ADC_FIFO_NOT_EMPTY
014b ---- 8b2c                         out         R0, [#IOP_EVCTL_SCEWEVSEL]
014c ---- fdb1                         wev1        #WEVSEL_PROG
014d ---- 8902                         in          R0, [#IOP_ANAIF_ADCFIFO]
014e ---- 0c9e                         st          R0, [#analyseIk/state/Uledi]
               ;? 
               ;? if (state.adcdowntimer == 0) {
014f ---- 08ba                         ld          R0, [#analyseIk/state/adcdowntimer]
0150 ---- 8a00                         cmp         R0, #0
0151 ---- be0f                         bneq        /id0308
               ;?     state.adcdowntimer = PERIOD_1S;
0152 ---- 0032                             ld          R0, #50
0153 ---- 0cba                             st          R0, [#analyseIk/state/adcdowntimer]
               ;?     gpioSetOutput(AUXIO_O_BT_ON_P);
0154 ---- 640e                             iobset      #(0 & 0x7), [#(IOP_AIODIO0_GPIODOUT + (0 >> 3))]
               ;?     fwDelayUs(500, FW_DELAY_RANGE_1_MS);
0155 ---- 705e                             ld          R7, #(((500 * 24 ) + ((1 << 7) - 1)) >> 7)
0156 ---- 6007                             ld          R6, #7
0157 ---- 17eb                             jsr         FwDelay
               ;? 
               ;? //    adcSelectGpioInput(AUXIO_A_BATTERY);
               ;? //    adcGenManualTrigger();
               ;? //    adcReadFifo(state.Ubat);
               ;? 
               ;?     adcSelectGpioInput(AUXIO_A_TEMPERAT);
0158 ---- 7001                             ld          R7, #1
0159 ---- 17de                             jsr         AdccompbSelectGpioInput
               ;?     adcGenManualTrigger();
015a ---- 6403                             iobset      #0, [#IOP_ANAIF_ADCTRIG]
               ;?     adcReadFifo(state.Ut);
015b ---- 001f                             ld          R0, #EVCTL_SCEEVSEL_ADC_FIFO_NOT_EMPTY
015c ---- 8b2c                             out         R0, [#IOP_EVCTL_SCEWEVSEL]
015d ---- fdb1                             wev1        #WEVSEL_PROG
015e ---- 8902                             in          R0, [#IOP_ANAIF_ADCFIFO]
015f ---- 0ca7                             st          R0, [#analyseIk/state/Ut]
               ;? 
               ;?     gpioClearOutput(AUXIO_O_BT_ON_P);
0160 ---- 440e                             iobclr      #(0 & 0x7), [#(IOP_AIODIO0_GPIODOUT + (0 >> 3))]
               ;? }
               /id0308:
               ;? // Disable the ADC
               ;? adcDisable();
0161 ---- 17f1                         jsr         AdcDisable
               ;? 
               ;? if(state.state == powerOn) {
0162 ---- 08c9                         ld          R0, [#analyseIk/state/state]
0163 ---- 8d29                         cmp         R0, R1
0164 ---- be48                         bneq        /id0319
               ;?     if (state.DowntimerRun == 0) {
0165 ---- 0893                             ld          R0, [#analyseIk/state/DowntimerRun]
0166 ---- 8a00                             cmp         R0, #0
0167 ---- be07                             bneq        /id0323
               ;?         ifnot (cfg.flags & FLAG_UCP_OK) {
0168 ---- 0885                                 ld          R0, [#analyseIk/cfg/flags]
0169 ---- 8c01                                 tst         R0, #1
016a ---- be03                                 bnz         /id0326
               ;?             fwGenAlertInterrupt();
016b ---- 0876                                     ld          R0, [#fwCtrlInt/bvTaskIoAlert]
016c ---- 8201                                     or          R0, #(1 << 0)
016d ---- 0c76                                     st          R0, [#fwCtrlInt/bvTaskIoAlert]
               ;?         }
               /id0326:
               ;?     } else {
016e ---- 05ac                             jmp         /id0325
               /id0323:
               ;?         if (state.PirAveragingSamples != 0) {
016f ---- 0896                                 ld          R0, [#analyseIk/state/PirAveragingSamples]
0170 ---- 8a00                                 cmp         R0, #0
0171 ---- b613                                 beq         /id0329
               ;?             state.PirAveragingSamples -= 1;
0172 ---- 0896                                     ld          R0, [#analyseIk/state/PirAveragingSamples]
0173 ---- 88ff                                     add         R0, #-1
0174 ---- 0c96                                     st          R0, [#analyseIk/state/PirAveragingSamples]
               ;?             cfg.Uacc = output.Upiri;
0175 ---- 088f                                     ld          R0, [#analyseIk/output/Upiri]
0176 ---- 0c80                                     st          R0, [#analyseIk/cfg/Uacc]
               ;?             cfg.Uacc += state.Uaccl;
0177 ---- 189b                                     ld          R1, [#analyseIk/state/Uaccl]
0178 ---- 0880                                     ld          R0, [#analyseIk/cfg/Uacc]
0179 ---- 8d21                                     add         R0, R1
017a ---- 0c80                                     st          R0, [#analyseIk/cfg/Uacc]
               ;?             if (cfg.Uacc < state.Uaccl) {
017b ---- 0880                                     ld          R0, [#analyseIk/cfg/Uacc]
017c ---- 189b                                     ld          R1, [#analyseIk/state/Uaccl]
017d ---- 8d29                                     cmp         R0, R1
017e ---- a603                                     bgeu        /id0339
               ;?                 state.Uacch += 1;
017f ---- 089a                                         ld          R0, [#analyseIk/state/Uacch]
0180 ---- 8801                                         add         R0, #1
0181 ---- 0c9a                                         st          R0, [#analyseIk/state/Uacch]
               ;?             }
               /id0339:
               ;?             state.Uaccl = cfg.Uacc;
0182 ---- 0880                                     ld          R0, [#analyseIk/cfg/Uacc]
0183 ---- 0c9b                                     st          R0, [#analyseIk/state/Uaccl]
               ;?         } else {
0184 ---- 05ac                                 jmp         /id0331
               /id0329:
               ;?             cfg.Uacc = state.Uacch << 9;
0185 ---- 089a                                     ld          R0, [#analyseIk/state/Uacch]
0186 ---- 8da0                                     lsl         R0, #8
0187 ---- 8da1                                     lsl         R0, #1
0188 ---- 0c80                                     st          R0, [#analyseIk/cfg/Uacc]
               ;?             cfg.Uacc += state.Uaccl >> 7;
0189 ---- 189b                                     ld          R1, [#analyseIk/state/Uaccl]
018a ---- 9daf                                     lsr         R1, #7
018b ---- 0880                                     ld          R0, [#analyseIk/cfg/Uacc]
018c ---- 8d21                                     add         R0, R1
018d ---- 0c80                                     st          R0, [#analyseIk/cfg/Uacc]
               ;?             if (cfg.Uacc < cfg.adcWindowHigh) {
018e ---- 0880                                     ld          R0, [#analyseIk/cfg/Uacc]
018f ---- 1882                                     ld          R1, [#analyseIk/cfg/adcWindowHigh]
0190 ---- 8d29                                     cmp         R0, R1
0191 ---- a614                                     bgeu        /id0350
               ;?                 if (cfg.Uacc > cfg.adcWindowLow) {
0192 ---- 0880                                         ld          R0, [#analyseIk/cfg/Uacc]
0193 ---- 1883                                         ld          R1, [#analyseIk/cfg/adcWindowLow]
0194 ---- 8d29                                         cmp         R0, R1
0195 ---- 9e09                                         bleu        /id0354
               ;?                     state.Ucp = cfg.Uacc;
0196 ---- 0880                                             ld          R0, [#analyseIk/cfg/Uacc]
0197 ---- 0c9d                                             st          R0, [#analyseIk/state/Ucp]
               ;? //                    cfg.flags |= FLAG_UCP_OK;
               ;?                     gpioClearOutput(AUXIO_O_PIR_OFF);
0198 ---- 440f                                             iobclr      #(8 & 0x7), [#(IOP_AIODIO0_GPIODOUT + (8 >> 3))]
               ;?                     state.state = waitIr;
0199 ---- 2cc9                                             st          R2, [#analyseIk/state/state]
               ;?                     state.Downtimer = PERIOD_5S;
019a ---- 00fa                                             ld          R0, #250
019b ---- 0c92                                             st          R0, [#analyseIk/state/Downtimer]
               ;?                     state.DowntimerRun = 1;
019c ---- 0001                                             ld          R0, #1
019d ---- 0c93                                             st          R0, [#analyseIk/state/DowntimerRun]
               ;?                 } else {
019e ---- 05a5                                         jmp         /id0357
               /id0354:
               ;?                     state.Uacch = 0;
019f ---- 0000                                             ld          R0, #0
01a0 ---- 0c9a                                             st          R0, [#analyseIk/state/Uacch]
               ;?                     state.Uaccl = 0;
01a1 ---- 0000                                             ld          R0, #0
01a2 ---- 0c9b                                             st          R0, [#analyseIk/state/Uaccl]
               ;?                     state.PirAveragingSamples = PIR_AVERAGING_TIME;
01a3 ---- 0080                                             ld          R0, #128
01a4 ---- 0c96                                             st          R0, [#analyseIk/state/PirAveragingSamples]
               ;?                 }
               /id0357:
               ;?             } else {
01a5 ---- 05ac                                     jmp         /id0353
               /id0350:
               ;?                 state.Uacch = 0;
01a6 ---- 0000                                         ld          R0, #0
01a7 ---- 0c9a                                         st          R0, [#analyseIk/state/Uacch]
               ;?                 state.Uaccl = 0;
01a8 ---- 0000                                         ld          R0, #0
01a9 ---- 0c9b                                         st          R0, [#analyseIk/state/Uaccl]
               ;?                 state.PirAveragingSamples = PIR_AVERAGING_TIME;
01aa ---- 0080                                         ld          R0, #128
01ab ---- 0c96                                         st          R0, [#analyseIk/state/PirAveragingSamples]
               ;?             }
               /id0353:
               ;?         }
               /id0331:
               ;?     }
               /id0325:
               ;? }else if (state.state == waitIr) {
01ac ---- 07ba                         jmp         /id0322
               /id0319:
01ad ---- 08c9                         ld          R0, [#analyseIk/state/state]
01ae ---- 8d2a                         cmp         R0, R2
01af ---- be1b                         bneq        /id0368
               ;?     if (state.DowntimerRun == 0) {
01b0 ---- 0893                             ld          R0, [#analyseIk/state/DowntimerRun]
01b1 ---- 8a00                             cmp         R0, #0
01b2 ---- be07                             bneq        /id0372
               ;?         ifnot (cfg.flags & FLAG_PIR_OK) {
01b3 ---- 0885                                 ld          R0, [#analyseIk/cfg/flags]
01b4 ---- 8c02                                 tst         R0, #2
01b5 ---- be03                                 bnz         /id0375
               ;?             fwGenAlertInterrupt();
01b6 ---- 0876                                     ld          R0, [#fwCtrlInt/bvTaskIoAlert]
01b7 ---- 8201                                     or          R0, #(1 << 0)
01b8 ---- 0c76                                     st          R0, [#fwCtrlInt/bvTaskIoAlert]
               ;?         }
               /id0375:
               ;?     } else {
01b9 ---- 05ca                             jmp         /id0374
               /id0372:
               ;?         if (output.Upiri < cfg.adcWindowHigh) {
01ba ---- 088f                                 ld          R0, [#analyseIk/output/Upiri]
01bb ---- 1882                                 ld          R1, [#analyseIk/cfg/adcWindowHigh]
01bc ---- 8d29                                 cmp         R0, R1
01bd ---- a60c                                 bgeu        /id0378
               ;?             if (output.Upiri > cfg.adcWindowLow) {
01be ---- 088f                                     ld          R0, [#analyseIk/output/Upiri]
01bf ---- 1883                                     ld          R1, [#analyseIk/cfg/adcWindowLow]
01c0 ---- 8d29                                     cmp         R0, R1
01c1 ---- 9e08                                     bleu        /id0381
               ;?                 cfg.flags |= FLAG_PIR_OK;
01c2 ---- 0885                                         ld          R0, [#analyseIk/cfg/flags]
01c3 ---- 8202                                         or          R0, #2
01c4 ---- 0c85                                         st          R0, [#analyseIk/cfg/flags]
               ;?                 state.state = common;
01c5 ---- 3cc9                                         st          R3, [#analyseIk/state/state]
               ;?                 state.Downtimer = 0;
01c6 ---- 0000                                         ld          R0, #0
01c7 ---- 0c92                                         st          R0, [#analyseIk/state/Downtimer]
               ;?                 state.DowntimerRun = 0;
01c8 ---- 0000                                         ld          R0, #0
01c9 ---- 0c93                                         st          R0, [#analyseIk/state/DowntimerRun]
               ;?             }
               /id0381:
               ;?         }
               /id0378:
               ;?     }
               /id0374:
               ;? }else if(state.state == common) {
01ca ---- 07ba                         jmp         /id0371
               /id0368:
01cb ---- 08c9                         ld          R0, [#analyseIk/state/state]
01cc ---- 8d2b                         cmp         R0, R3
01cd ---- b601                         beq         /br0000 ; Repaired out-of-range bneq
01ce ---- 07ba                         jmp         /id0389
               /br0000:
               ;?     if (state.alarmdowntimerrun != 0) {
01cf ---- 08bc                             ld          R0, [#analyseIk/state/alarmdowntimerrun]
01d0 ---- 8a00                             cmp         R0, #0
01d1 ---- b612                             beq         /id0392
               ;?         state.alarmdowntimer -= 1;
01d2 ---- 08bb                                 ld          R0, [#analyseIk/state/alarmdowntimer]
01d3 ---- 88ff                                 add         R0, #-1
01d4 ---- 0cbb                                 st          R0, [#analyseIk/state/alarmdowntimer]
               ;?         if (state.alarmdowntimer == 0) {
01d5 ---- 08bb                                 ld          R0, [#analyseIk/state/alarmdowntimer]
01d6 ---- 8a00                                 cmp         R0, #0
01d7 ---- be0c                                 bneq        /id0396
               ;?             state.alarmdowntimerrun = 0;
01d8 ---- 0000                                     ld          R0, #0
01d9 ---- 0cbc                                     st          R0, [#analyseIk/state/alarmdowntimerrun]
               ;?             if (AP_IK_ALARM_FLAG & state.IKstate) {
01da ---- 0894                                     ld          R0, [#analyseIk/state/IKstate]
01db ---- 8c02                                     tst         R0, #2
01dc ---- b607                                     bz          /id0399
               ;?                 state.PirPulseCounter -= PIR_SENS;
01dd ---- 0898                                         ld          R0, [#analyseIk/state/PirPulseCounter]
01de ---- 88fe                                         add         R0, #-2
01df ---- 0c98                                         st          R0, [#analyseIk/state/PirPulseCounter]
               ;?                 state.IKstate &= ~AP_IK_ALARM_FLAG;
01e0 ---- 0894                                         ld          R0, [#analyseIk/state/IKstate]
01e1 86ff 80fd                                         and         R0, #65533
01e3 ---- 0c94                                         st          R0, [#analyseIk/state/IKstate]
               ;?             }
               /id0399:
               ;?         }
               /id0396:
               ;?     }
               /id0392:
               ;?     if (state.idledowntimerrun != 0) {
01e4 ---- 08c1                             ld          R0, [#analyseIk/state/idledowntimerrun]
01e5 ---- 8a00                             cmp         R0, #0
01e6 ---- b610                             beq         /id0405
               ;?         state.idledowntimer -= 1;
01e7 ---- 08c0                                 ld          R0, [#analyseIk/state/idledowntimer]
01e8 ---- 88ff                                 add         R0, #-1
01e9 ---- 0cc0                                 st          R0, [#analyseIk/state/idledowntimer]
               ;?         if (state.idledowntimer == 0) {
01ea ---- 08c0                                 ld          R0, [#analyseIk/state/idledowntimer]
01eb ---- 8a00                                 cmp         R0, #0
01ec ---- be0a                                 bneq        /id0409
               ;?             state.idledowntimerrun = 0;
01ed ---- 0000                                     ld          R0, #0
01ee ---- 0cc1                                     st          R0, [#analyseIk/state/idledowntimerrun]
               ;?             if (state.PirPulseCounter > 0) {
01ef ---- 0898                                     ld          R0, [#analyseIk/state/PirPulseCounter]
01f0 ---- 8a00                                     cmp         R0, #0
01f1 ---- fe05                                     bles        /id0412
               ;?                 ifnot (AP_IK_ALARM_FLAG & state.IKstate) {
01f2 ---- 0894                                         ld          R0, [#analyseIk/state/IKstate]
01f3 ---- 8c02                                         tst         R0, #2
01f4 ---- be02                                         bnz         /id0414
               ;?                     state.PirPulseCounter = 0;
01f5 ---- 0000                                             ld          R0, #0
01f6 ---- 0c98                                             st          R0, [#analyseIk/state/PirPulseCounter]
               ;?                 }
               /id0414:
               ;?             }
               /id0412:
               ;?         }
               /id0409:
               ;?     }
               /id0405:
               ;?     if (state.lightdowntimerrun != 0) {
01f7 ---- 08c3                             ld          R0, [#analyseIk/state/lightdowntimerrun]
01f8 ---- 8a00                             cmp         R0, #0
01f9 ---- b60d                             beq         /id0417
               ;?         state.lightdowntimer -= 1;
01fa ---- 08c2                                 ld          R0, [#analyseIk/state/lightdowntimer]
01fb ---- 88ff                                 add         R0, #-1
01fc ---- 0cc2                                 st          R0, [#analyseIk/state/lightdowntimer]
               ;?         if (state.lightdowntimer == 0) {
01fd ---- 08c2                                 ld          R0, [#analyseIk/state/lightdowntimer]
01fe ---- 8a00                                 cmp         R0, #0
01ff ---- be07                                 bneq        /id0421
               ;?             state.lightdowntimerrun = 0;
0200 ---- 0000                                     ld          R0, #0
0201 ---- 0cc3                                     st          R0, [#analyseIk/state/lightdowntimerrun]
               ;?             if (state.PirPulseCounter == MINUS_ONE) {
0202 ---- 0898                                     ld          R0, [#analyseIk/state/PirPulseCounter]
0203 ---- 8aff                                     cmp         R0, #-1
0204 ---- be02                                     bneq        /id0424
               ;?                 state.PirPulseCounter = 0;
0205 ---- 0000                                         ld          R0, #0
0206 ---- 0c98                                         st          R0, [#analyseIk/state/PirPulseCounter]
               ;?             }
               /id0424:
               ;?         }
               /id0421:
               ;?     }
               /id0417:
               ;?     if (state.thrdowntimerrun != 0) {
0207 ---- 08cb                             ld          R0, [#analyseIk/state/thrdowntimerrun]
0208 ---- 8a00                             cmp         R0, #0
0209 ---- b610                             beq         /id0427
               ;?         state.thrdowntimer -= 1;
020a ---- 08ca                                 ld          R0, [#analyseIk/state/thrdowntimer]
020b ---- 88ff                                 add         R0, #-1
020c ---- 0cca                                 st          R0, [#analyseIk/state/thrdowntimer]
               ;?         if (state.thrdowntimer == 0) {
020d ---- 08ca                                 ld          R0, [#analyseIk/state/thrdowntimer]
020e ---- 8a00                                 cmp         R0, #0
020f ---- be0a                                 bneq        /id0431
               ;?             state.thrdowntimerrun = 0;
0210 ---- 0000                                     ld          R0, #0
0211 ---- 0ccb                                     st          R0, [#analyseIk/state/thrdowntimerrun]
               ;?             if (l_Upl != state.Upl) {
0212 ---- 08a6                                     ld          R0, [#analyseIk/state/Upl]
0213 ---- dd28                                     cmp         R5, R0
0214 ---- b601                                     beq         /id0434
               ;?                 state.Upl = l_Upl;
0215 ---- 5ca6                                         st          R5, [#analyseIk/state/Upl]
               ;?             }
               /id0434:
               ;?             if (l_Uph != state.Uph) {
0216 ---- 08a2                                     ld          R0, [#analyseIk/state/Uph]
0217 ---- cd28                                     cmp         R4, R0
0218 ---- b601                                     beq         /id0438
               ;?                 state.Uph = l_Uph;
0219 ---- 4ca2                                         st          R4, [#analyseIk/state/Uph]
               ;?             }
               /id0438:
               ;?         }
               /id0431:
               ;?     }
               /id0427:
               ;?     if (state.lightdowntimerrun != 0) {
021a ---- 08c3                             ld          R0, [#analyseIk/state/lightdowntimerrun]
021b ---- 8a00                             cmp         R0, #0
021c ---- b60d                             beq         /id0442
               ;?         state.lightdowntimer -= 1;
021d ---- 08c2                                 ld          R0, [#analyseIk/state/lightdowntimer]
021e ---- 88ff                                 add         R0, #-1
021f ---- 0cc2                                 st          R0, [#analyseIk/state/lightdowntimer]
               ;?         if (state.lightdowntimer == 0) {
0220 ---- 08c2                                 ld          R0, [#analyseIk/state/lightdowntimer]
0221 ---- 8a00                                 cmp         R0, #0
0222 ---- be07                                 bneq        /id0446
               ;?             state.lightdowntimerrun = 0;
0223 ---- 0000                                     ld          R0, #0
0224 ---- 0cc3                                     st          R0, [#analyseIk/state/lightdowntimerrun]
               ;?             if (state.PirPulseCounter == MINUS_ONE) {
0225 ---- 0898                                     ld          R0, [#analyseIk/state/PirPulseCounter]
0226 ---- 8aff                                     cmp         R0, #-1
0227 ---- be02                                     bneq        /id0449
               ;?                 state.PirPulseCounter = 0;
0228 ---- 0000                                         ld          R0, #0
0229 ---- 0c98                                         st          R0, [#analyseIk/state/PirPulseCounter]
               ;?             }
               /id0449:
               ;?         }
               /id0446:
               ;?     }
               /id0442:
               ;?     n = state.Uledidx;
022a ---- 089f                             ld          R0, [#analyseIk/state/Uledidx]
               ;?     state.aUled[n] = state.Uledi;
022b ---- 189e                             ld          R1, [#analyseIk/state/Uledi]
022c ---- 20a8                             ld          R2, #(analyseIk/state/aUled + 0)
022d ---- 9f3a                             st          R1, [R2+R0]
               ;?     n += 1;
022e ---- 8801                             add         R0, #1
               ;?     if (n >= ULED_BUF_SIZE) {
022f ---- 8a10                             cmp         R0, #16
0230 ---- ee03                             blts        /id0456
               ;?         n = 0;
0231 ---- 0000                                 ld          R0, #0
               ;?         cfg.CntMinusOne = 1;
0232 ---- 1001                                 ld          R1, #1
0233 ---- 1c7f                                 st          R1, [#analyseIk/cfg/CntMinusOne]
               ;?     }
               /id0456:
               ;?     state.Uledidx = n;
0234 ---- 0c9f                             st          R0, [#analyseIk/state/Uledidx]
               ;?     state.Uledmax = state.aUled[0];
0235 ---- 08a8                             ld          R0, [#(analyseIk/state/aUled + 0)]
0236 ---- 0ca0                             st          R0, [#analyseIk/state/Uledmax]
               ;?     state.Uledmin = state.aUled[ULED_BUF_SIZE - 1];
0237 ---- 08b7                             ld          R0, [#(analyseIk/state/aUled + 15)]
0238 ---- 0ca1                             st          R0, [#analyseIk/state/Uledmin]
               ;?     //    for (U16 n = 0; n < ULED_BUF_SIZE; n++) {
               ;?     n = ULED_BUF_SIZE - 2;
0239 ---- 000e                             ld          R0, #14
               ;?     while(n > 0) {
               /id0464:
023a ---- 8a00                             cmp         R0, #0
023b ---- fe12                             bles        /id0465
               ;?         if (state.Uledmax < state.aUled[n]) {
023c ---- 18a0                                 ld          R1, [#analyseIk/state/Uledmax]
023d ---- 20a8                                 ld          R2, #(analyseIk/state/aUled + 0)
023e ---- af1a                                 ld          R2, [R2+R0]
023f ---- 9d2a                                 cmp         R1, R2
0240 ---- a603                                 bgeu        /id0467
               ;?             state.Uledmax = state.aUled[n];
0241 ---- 10a8                                     ld          R1, #(analyseIk/state/aUled + 0)
0242 ---- 9f19                                     ld          R1, [R1+R0]
0243 ---- 1ca0                                     st          R1, [#analyseIk/state/Uledmax]
               ;?         }
               /id0467:
               ;?         if (state.Uledmin > state.aUled[n]) {
0244 ---- 18a1                                 ld          R1, [#analyseIk/state/Uledmin]
0245 ---- 20a8                                 ld          R2, #(analyseIk/state/aUled + 0)
0246 ---- af1a                                 ld          R2, [R2+R0]
0247 ---- 9d2a                                 cmp         R1, R2
0248 ---- 9e03                                 bleu        /id0473
               ;?             state.Uledmin = state.aUled[n];
0249 ---- 10a8                                     ld          R1, #(analyseIk/state/aUled + 0)
024a ---- 9f19                                     ld          R1, [R1+R0]
024b ---- 1ca1                                     st          R1, [#analyseIk/state/Uledmin]
               ;?         }
               /id0473:
               ;?         n -= 1;
024c ---- 88ff                                 add         R0, #-1
               ;?     }
024d ---- 063a                             jmp         /id0464
               /id0465:
               ;?     state.dUled = state.Uledmax - state.Uledmin;
024e ---- 08a0                             ld          R0, [#analyseIk/state/Uledmax]
024f ---- 18a1                             ld          R1, [#analyseIk/state/Uledmin]
0250 ---- 8d19                             sub         R0, R1
0251 ---- 0cbd                             st          R0, [#analyseIk/state/dUled]
               ;?     if (input.isTestMode == 0) {
0252 ---- 0889                             ld          R0, [#analyseIk/input/isTestMode]
0253 ---- 8a00                             cmp         R0, #0
0254 ---- be23                             bneq        /id0482
               ;?         if (cfg.CntMinusOne == 1) {
0255 ---- 087f                                 ld          R0, [#analyseIk/cfg/CntMinusOne]
0256 ---- 8a01                                 cmp         R0, #1
0257 ---- be20                                 bneq        /id0484
               ;?             if (state.alarmdowntimerrun == 0) {
0258 ---- 08bc                                     ld          R0, [#analyseIk/state/alarmdowntimerrun]
0259 ---- 8a00                                     cmp         R0, #0
025a ---- be1d                                     bneq        /id0486
               ;?                 if (state.dUled > LIGHT_THRESHOLD) {
025b ---- 08bd                                         ld          R0, [#analyseIk/state/dUled]
025c 8600 8ac8                                         cmp         R0, #200
025e ---- 9e17                                         bleu        /id0488
               ;?                     if (state.PirPulseCounter <= 0) {
025f ---- 0898                                             ld          R0, [#analyseIk/state/PirPulseCounter]
0260 ---- 8a00                                             cmp         R0, #0
0261 ---- f611                                             bgts        /id0491
               ;?                         state.LightThrCounter += 1;
0262 ---- 0895                                                 ld          R0, [#analyseIk/state/LightThrCounter]
0263 ---- 8801                                                 add         R0, #1
0264 ---- 0c95                                                 st          R0, [#analyseIk/state/LightThrCounter]
               ;?                         if (state.LightThrCounter <= LIGHT_ACC_THRESHOLD) {
0265 ---- 0895                                                 ld          R0, [#analyseIk/state/LightThrCounter]
0266 ---- 8a1e                                                 cmp         R0, #30
0267 ---- 960a                                                 bgtu        /id0496
               ;?                             if (0 == state.PirPulseCounter) {
0268 ---- 0898                                                     ld          R0, [#analyseIk/state/PirPulseCounter]
0269 ---- 8a00                                                     cmp         R0, #0
026a ---- be07                                                     bneq        /id0498
               ;?                                 state.lightdowntimer = LIGHT_RESTORE_PERIOD;
026b ---- 0190                                                         ld          R0, #400
026c ---- 0cc2                                                         st          R0, [#analyseIk/state/lightdowntimer]
               ;?                                 state.lightdowntimerrun = 1;
026d ---- 0001                                                         ld          R0, #1
026e ---- 0cc3                                                         st          R0, [#analyseIk/state/lightdowntimerrun]
               ;?                                 state.PirPulseCounter -= 1;
026f ---- 0898                                                         ld          R0, [#analyseIk/state/PirPulseCounter]
0270 ---- 88ff                                                         add         R0, #-1
0271 ---- 0c98                                                         st          R0, [#analyseIk/state/PirPulseCounter]
               ;?                             }
               /id0498:
               ;?                         }
               /id0496:
               ;?                     } else {
0272 ---- 0675                                             jmp         /id0493
               /id0491:
               ;?                         state.LightThrCounter = 0;
0273 ---- 0000                                                 ld          R0, #0
0274 ---- 0c95                                                 st          R0, [#analyseIk/state/LightThrCounter]
               ;?                     }
               /id0493:
               ;?                 } else {
0275 ---- 0678                                         jmp         /id0490
               /id0488:
               ;?                     state.LightThrCounter = 0;
0276 ---- 0000                                             ld          R0, #0
0277 ---- 0c95                                             st          R0, [#analyseIk/state/LightThrCounter]
               ;?                 }
               /id0490:
               ;?             }
               /id0486:
               ;?         }
               /id0484:
               ;?     }
               /id0482:
               ;?     //    if (state.lightdowntimerrun == 0) {
               ;?     //        if (state.PirPulseCounter == MINUS_ONE) {
               ;?     //            state.PirPulseCounter = 0;
               ;?     //        }
               ;?     //    }
               ;?     state.Upiri2 = state.Upiri1;
0278 ---- 08a4                             ld          R0, [#analyseIk/state/Upiri1]
0279 ---- 0ca5                             st          R0, [#analyseIk/state/Upiri2]
               ;?     state.Upiri1 = state.Upiri;
027a ---- 08a3                             ld          R0, [#analyseIk/state/Upiri]
027b ---- 0ca4                             st          R0, [#analyseIk/state/Upiri1]
               ;?     state.Upiri = output.Upiri;
027c ---- 088f                             ld          R0, [#analyseIk/output/Upiri]
027d ---- 0ca3                             st          R0, [#analyseIk/state/Upiri]
               ;? 
               ;?     state.deltaU = state.Upiri - state.Ucp;
027e ---- 08a3                             ld          R0, [#analyseIk/state/Upiri]
027f ---- 189d                             ld          R1, [#analyseIk/state/Ucp]
0280 ---- 8d19                             sub         R0, R1
0281 ---- 0cbe                             st          R0, [#analyseIk/state/deltaU]
               ;?     state.deltaU1 = state.Upiri1 - state.Ucp;
0282 ---- 08a4                             ld          R0, [#analyseIk/state/Upiri1]
0283 ---- 189d                             ld          R1, [#analyseIk/state/Ucp]
0284 ---- 8d19                             sub         R0, R1
0285 ---- 0cbf                             st          R0, [#analyseIk/state/deltaU1]
               ;?     state.slope1 = state.Upiri - state.Upiri1;
0286 ---- 08a3                             ld          R0, [#analyseIk/state/Upiri]
0287 ---- 18a4                             ld          R1, [#analyseIk/state/Upiri1]
0288 ---- 8d19                             sub         R0, R1
0289 ---- 0cc7                             st          R0, [#analyseIk/state/slope1]
               ;?     state.slope1 = (@state.slope1);
028a ---- 08c7                             ld          R0, [#analyseIk/state/slope1]
028b ---- 8d90                             abs         R0
028c ---- 0cc7                             st          R0, [#analyseIk/state/slope1]
               ;?     state.slope2 = state.Upiri1 - state.Upiri2;
028d ---- 08a4                             ld          R0, [#analyseIk/state/Upiri1]
028e ---- 18a5                             ld          R1, [#analyseIk/state/Upiri2]
028f ---- 8d19                             sub         R0, R1
0290 ---- 0cc8                             st          R0, [#analyseIk/state/slope2]
               ;?     state.slope2 = (@state.slope2);
0291 ---- 08c8                             ld          R0, [#analyseIk/state/slope2]
0292 ---- 8d90                             abs         R0
0293 ---- 0cc8                             st          R0, [#analyseIk/state/slope2]
               ;?     state.maxslope = state.slope1;
0294 ---- 08c7                             ld          R0, [#analyseIk/state/slope1]
0295 ---- 0cc6                             st          R0, [#analyseIk/state/maxslope]
               ;?     if (state.maxslope < state.slope2) {
0296 ---- 08c6                             ld          R0, [#analyseIk/state/maxslope]
0297 ---- 18c8                             ld          R1, [#analyseIk/state/slope2]
0298 ---- 8d29                             cmp         R0, R1
0299 ---- e602                             bges        /id0520
               ;?         state.maxslope = state.slope2;
029a ---- 08c8                                 ld          R0, [#analyseIk/state/slope2]
029b ---- 0cc6                                 st          R0, [#analyseIk/state/maxslope]
               ;?     }
               /id0520:
               ;?     state.absdU = (@state.deltaU);
029c ---- 08be                             ld          R0, [#analyseIk/state/deltaU]
029d ---- 8d90                             abs         R0
029e ---- 0cb8                             st          R0, [#analyseIk/state/absdU]
               ;?     state.absdU1 = (@state.deltaU1);
029f ---- 08bf                             ld          R0, [#analyseIk/state/deltaU1]
02a0 ---- 8d90                             abs         R0
02a1 ---- 0cb9                             st          R0, [#analyseIk/state/absdU1]
               ;? 
               ;?     if (state.PirOutOfPipe != 0) {
02a2 ---- 0897                             ld          R0, [#analyseIk/state/PirOutOfPipe]
02a3 ---- 8a00                             cmp         R0, #0
02a4 ---- b660                             beq         /id0526
               ;?         if (state.deltaU >= 0) {
02a5 ---- 08be                                 ld          R0, [#analyseIk/state/deltaU]
02a6 ---- 8a00                                 cmp         R0, #0
02a7 ---- ee1a                                 blts        /id0528
               ;?             if (state.deltaU1 < 0) {
02a8 ---- 08bf                                     ld          R0, [#analyseIk/state/deltaU1]
02a9 ---- 8a00                                     cmp         R0, #0
02aa ---- e616                                     bges        /id0531
               ;?                 PirDynamicThresh = (state.maxUl + 1) >> 1;
02ab ---- 08c5                                         ld          R0, [#analyseIk/state/maxUl]
02ac ---- 8801                                         add         R0, #1
02ad ---- 8da9                                         lsr         R0, #1
               ;?                 if (PirDynamicThresh > PIR_THRESHOLD) {
02ae 8600 8aac                                         cmp         R0, #172
02b0 ---- 9e04                                         bleu        /id0534
               ;?                     state.Uph = state.Ucp + PirDynamicThresh;
02b1 ---- 189d                                             ld          R1, [#analyseIk/state/Ucp]
02b2 ---- 9d20                                             add         R1, R0
02b3 ---- 1ca2                                             st          R1, [#analyseIk/state/Uph]
               ;?                 } else {
02b4 ---- 06b6                                         jmp         /id0536
               /id0534:
               ;?                     state.Uph = l_Uph;
02b5 ---- 4ca2                                             st          R4, [#analyseIk/state/Uph]
               ;?                 }
               /id0536:
               ;?                 state.thrdowntimer = PIR_IDLE_PERIOD;
02b6 ---- 0190                                         ld          R0, #400
02b7 ---- 0cca                                         st          R0, [#analyseIk/state/thrdowntimer]
               ;?                 state.thrdowntimerrun = 1;
02b8 ---- 0001                                         ld          R0, #1
02b9 ---- 0ccb                                         st          R0, [#analyseIk/state/thrdowntimerrun]
               ;?                 state.Upl = l_Upl;
02ba ---- 5ca6                                         st          R5, [#analyseIk/state/Upl]
               ;?                 state.PirOutOfPipe = 0;
02bb ---- 0000                                         ld          R0, #0
02bc ---- 0c97                                         st          R0, [#analyseIk/state/PirOutOfPipe]
               ;?                 state.maxUh = 0;
02bd ---- 0000                                         ld          R0, #0
02be ---- 0cc4                                         st          R0, [#analyseIk/state/maxUh]
               ;?                 state.maxUl = 0;
02bf ---- 0000                                         ld          R0, #0
02c0 ---- 0cc5                                         st          R0, [#analyseIk/state/maxUl]
               ;?             }
               /id0531:
               ;?         } else {
02c1 ---- 06db                                 jmp         /id0530
               /id0528:
               ;?             if (state.deltaU1 >= 0) {
02c2 ---- 08bf                                     ld          R0, [#analyseIk/state/deltaU1]
02c3 ---- 8a00                                     cmp         R0, #0
02c4 ---- ee16                                     blts        /id0546
               ;?                 PirDynamicThresh = (state.maxUh + 1) >> 1;
02c5 ---- 08c4                                         ld          R0, [#analyseIk/state/maxUh]
02c6 ---- 8801                                         add         R0, #1
02c7 ---- 8da9                                         lsr         R0, #1
               ;?                 if (PirDynamicThresh > PIR_THRESHOLD) {
02c8 8600 8aac                                         cmp         R0, #172
02ca ---- 9e04                                         bleu        /id0549
               ;?                     state.Upl = state.Ucp - PirDynamicThresh;
02cb ---- 189d                                             ld          R1, [#analyseIk/state/Ucp]
02cc ---- 9d18                                             sub         R1, R0
02cd ---- 1ca6                                             st          R1, [#analyseIk/state/Upl]
               ;?                 } else {
02ce ---- 06d0                                         jmp         /id0551
               /id0549:
               ;?                     state.Upl = l_Upl;
02cf ---- 5ca6                                             st          R5, [#analyseIk/state/Upl]
               ;?                 }
               /id0551:
               ;?                 state.thrdowntimer = PIR_IDLE_PERIOD;
02d0 ---- 0190                                         ld          R0, #400
02d1 ---- 0cca                                         st          R0, [#analyseIk/state/thrdowntimer]
               ;?                 state.thrdowntimerrun = 1;
02d2 ---- 0001                                         ld          R0, #1
02d3 ---- 0ccb                                         st          R0, [#analyseIk/state/thrdowntimerrun]
               ;?                 state.Uph = l_Uph;
02d4 ---- 4ca2                                         st          R4, [#analyseIk/state/Uph]
               ;?                 state.PirOutOfPipe = 0;
02d5 ---- 0000                                         ld          R0, #0
02d6 ---- 0c97                                         st          R0, [#analyseIk/state/PirOutOfPipe]
               ;?                 state.maxUh = 0;
02d7 ---- 0000                                         ld          R0, #0
02d8 ---- 0cc4                                         st          R0, [#analyseIk/state/maxUh]
               ;?                 state.maxUl = 0;
02d9 ---- 0000                                         ld          R0, #0
02da ---- 0cc5                                         st          R0, [#analyseIk/state/maxUl]
               ;?             }
               /id0546:
               ;?         }
               /id0530:
               ;?         if (state.absdU < PIR_NOISE_THRESHOLD) {
02db ---- 08b8                                 ld          R0, [#analyseIk/state/absdU]
02dc ---- 8a39                                 cmp         R0, #57
02dd ---- a627                                 bgeu        /id0561
               ;?             if (state.maxUl >= state.maxUh) {
02de ---- 08c5                                     ld          R0, [#analyseIk/state/maxUl]
02df ---- 18c4                                     ld          R1, [#analyseIk/state/maxUh]
02e0 ---- 8d29                                     cmp         R0, R1
02e1 ---- ae0d                                     bltu        /id0563
               ;?                 PirDynamicThresh = (state.maxUl + 1) >> 1;
02e2 ---- 08c5                                         ld          R0, [#analyseIk/state/maxUl]
02e3 ---- 8801                                         add         R0, #1
02e4 ---- 8da9                                         lsr         R0, #1
               ;?                 if (PirDynamicThresh > PIR_THRESHOLD) {
02e5 8600 8aac                                         cmp         R0, #172
02e7 ---- 9e04                                         bleu        /id0568
               ;?                     state.Uph = state.Ucp + PirDynamicThresh;
02e8 ---- 189d                                             ld          R1, [#analyseIk/state/Ucp]
02e9 ---- 9d20                                             add         R1, R0
02ea ---- 1ca2                                             st          R1, [#analyseIk/state/Uph]
               ;?                 } else {
02eb ---- 06ed                                         jmp         /id0570
               /id0568:
               ;?                     state.Uph = l_Uph;
02ec ---- 4ca2                                             st          R4, [#analyseIk/state/Uph]
               ;?                 }
               /id0570:
               ;?                 state.Upl = l_Upl;
02ed ---- 5ca6                                         st          R5, [#analyseIk/state/Upl]
               ;?             } else {
02ee ---- 06fb                                     jmp         /id0566
               /id0563:
               ;?                 PirDynamicThresh = (state.maxUh + 1) >> 1;
02ef ---- 08c4                                         ld          R0, [#analyseIk/state/maxUh]
02f0 ---- 8801                                         add         R0, #1
02f1 ---- 8da9                                         lsr         R0, #1
               ;?                 if (PirDynamicThresh > PIR_THRESHOLD) {
02f2 8600 8aac                                         cmp         R0, #172
02f4 ---- 9e04                                         bleu        /id0576
               ;?                     state.Upl = state.Ucp - PirDynamicThresh;
02f5 ---- 189d                                             ld          R1, [#analyseIk/state/Ucp]
02f6 ---- 9d18                                             sub         R1, R0
02f7 ---- 1ca6                                             st          R1, [#analyseIk/state/Upl]
               ;?                 } else {
02f8 ---- 06fa                                         jmp         /id0578
               /id0576:
               ;?                     state.Upl = l_Upl;
02f9 ---- 5ca6                                             st          R5, [#analyseIk/state/Upl]
               ;?                 }
               /id0578:
               ;?                 state.Uph = l_Uph;
02fa ---- 4ca2                                         st          R4, [#analyseIk/state/Uph]
               ;?             }
               /id0566:
               ;?             state.thrdowntimer = PIR_IDLE_PERIOD;
02fb ---- 0190                                     ld          R0, #400
02fc ---- 0cca                                     st          R0, [#analyseIk/state/thrdowntimer]
               ;?             state.thrdowntimerrun = 1;
02fd ---- 0001                                     ld          R0, #1
02fe ---- 0ccb                                     st          R0, [#analyseIk/state/thrdowntimerrun]
               ;?             state.PirOutOfPipe = 0;
02ff ---- 0000                                     ld          R0, #0
0300 ---- 0c97                                     st          R0, [#analyseIk/state/PirOutOfPipe]
               ;?             state.maxUh = 0;
0301 ---- 0000                                     ld          R0, #0
0302 ---- 0cc4                                     st          R0, [#analyseIk/state/maxUh]
               ;?             state.maxUl = 0;
0303 ---- 0000                                     ld          R0, #0
0304 ---- 0cc5                                     st          R0, [#analyseIk/state/maxUl]
               ;?         }
               /id0561:
               ;?     }
               /id0526:
               ;?     if (state.absdU > PIR_THRESHOLD) {
0305 ---- 08b8                             ld          R0, [#analyseIk/state/absdU]
0306 8600 8aac                             cmp         R0, #172
0308 ---- 9e14                             bleu        /id0588
               ;?         if (state.absdU1 <= PIR_THRESHOLD) {
0309 ---- 08b9                                 ld          R0, [#analyseIk/state/absdU1]
030a 8600 8aac                                 cmp         R0, #172
030c ---- 9602                                 bgtu        /id0590
               ;?             state.PirOutOfPipe = 1;
030d ---- 0001                                     ld          R0, #1
030e ---- 0c97                                     st          R0, [#analyseIk/state/PirOutOfPipe]
               ;?         }
               /id0590:
               ;?         if (state.deltaU >= 0) {
030f ---- 08be                                 ld          R0, [#analyseIk/state/deltaU]
0310 ---- 8a00                                 cmp         R0, #0
0311 ---- ee06                                 blts        /id0593
               ;?             if (state.deltaU1 < 0) {
0312 ---- 08bf                                     ld          R0, [#analyseIk/state/deltaU1]
0313 ---- 8a00                                     cmp         R0, #0
0314 ---- e602                                     bges        /id0596
               ;?                 state.PirOutOfPipe = 1;
0315 ---- 0001                                         ld          R0, #1
0316 ---- 0c97                                         st          R0, [#analyseIk/state/PirOutOfPipe]
               ;?             }
               /id0596:
               ;?         } else {
0317 ---- 071d                                 jmp         /id0595
               /id0593:
               ;?             if (state.deltaU1 >= 0) {
0318 ---- 08bf                                     ld          R0, [#analyseIk/state/deltaU1]
0319 ---- 8a00                                     cmp         R0, #0
031a ---- ee02                                     blts        /id0599
               ;?                 state.PirOutOfPipe = 1;
031b ---- 0001                                         ld          R0, #1
031c ---- 0c97                                         st          R0, [#analyseIk/state/PirOutOfPipe]
               ;?             }
               /id0599:
               ;?         }
               /id0595:
               ;?     }
               /id0588:
               ;? 
               ;?     condition = 0;
031d ---- 0000                             ld          R0, #0
               ;?     if (state.deltaU >= 0) {
031e ---- 18be                             ld          R1, [#analyseIk/state/deltaU]
031f ---- 9a00                             cmp         R1, #0
0320 ---- ee07                             blts        /id0603
               ;?         if (state.deltaU1 < 0) {
0321 ---- 18bf                                 ld          R1, [#analyseIk/state/deltaU1]
0322 ---- 9a00                                 cmp         R1, #0
0323 ---- e603                                 bges        /id0606
               ;?             state.PirPulsePresense = 0;
0324 ---- 0000                                     ld          R0, #0
0325 ---- 0c99                                     st          R0, [#analyseIk/state/PirPulsePresense]
               ;?             condition = 1;
0326 ---- 0001                                     ld          R0, #1
               ;?         }
               /id0606:
               ;?     } else {
0327 ---- 072e                             jmp         /id0605
               /id0603:
               ;?         if (state.deltaU1 >= 0) {
0328 ---- 18bf                                 ld          R1, [#analyseIk/state/deltaU1]
0329 ---- 9a00                                 cmp         R1, #0
032a ---- ee03                                 blts        /id0610
               ;?             state.PirPulsePresense = 0;
032b ---- 0000                                     ld          R0, #0
032c ---- 0c99                                     st          R0, [#analyseIk/state/PirPulsePresense]
               ;?             condition = 1;
032d ---- 0001                                     ld          R0, #1
               ;?         }
               /id0610:
               ;?     }
               /id0605:
               ;? 
               ;?     if (condition == 0) {
032e ---- 8a00                             cmp         R0, #0
032f ---- be74                             bneq        /id0614
               ;?         if (state.absdU < PIR_NOISE_THRESHOLD) {
0330 ---- 08b8                                 ld          R0, [#analyseIk/state/absdU]
0331 ---- 8a39                                 cmp         R0, #57
0332 ---- a603                                 bgeu        /id0616
               ;?             state.PirPulsePresense = 0;
0333 ---- 0000                                     ld          R0, #0
0334 ---- 0c99                                     st          R0, [#analyseIk/state/PirPulsePresense]
               ;?         } else {
0335 ---- 07a4                                 jmp         /id0618
               /id0616:
               ;?             if (state.deltaU >= 0) {
0336 ---- 08be                                     ld          R0, [#analyseIk/state/deltaU]
0337 ---- 8a00                                     cmp         R0, #0
0338 ---- ee36                                     blts        /id0620
               ;?                 condition = 0;
0339 ---- 0000                                         ld          R0, #0
               ;?                 if (state.Upiri > state.Uph) {
033a ---- 18a3                                         ld          R1, [#analyseIk/state/Upiri]
033b ---- 28a2                                         ld          R2, [#analyseIk/state/Uph]
033c ---- 9d2a                                         cmp         R1, R2
033d ---- 9e05                                         bleu        /id0624
               ;?                     if (state.Upiri1 <= state.Uph) {
033e ---- 18a4                                             ld          R1, [#analyseIk/state/Upiri1]
033f ---- 28a2                                             ld          R2, [#analyseIk/state/Uph]
0340 ---- 9d2a                                             cmp         R1, R2
0341 ---- 9601                                             bgtu        /id0627
               ;?                         condition = 1;
0342 ---- 0001                                                 ld          R0, #1
               ;?                     }
               /id0627:
               ;?                 }
               /id0624:
               ;?                 // ?????? ???? ?????
               ;?                 if (condition == 1) {
0343 ---- 8a01                                         cmp         R0, #1
0344 ---- be1e                                         bneq        /id0631
               ;?                     // (state.Upiri > state.Uph) && (state.Upiri1 <= state.Uph)
               ;?                     condition = 0;
               ;?                     if (state.maxslope < PIR_SLOPE_THRESHOLD) {
0345 ---- 08c6                                             ld          R0, [#analyseIk/state/maxslope]
0346 8603 8ac0                                             cmp         R0, #960
0348 ---- e615                                             bges        /id0635
               ;?                         if (state.PirPulsePresense == 0) {
0349 ---- 0899                                                 ld          R0, [#analyseIk/state/PirPulsePresense]
034a ---- 8a00                                                 cmp         R0, #0
034b ---- be12                                                 bneq        /id0637
               ;?                             ifnot (state.IKstate & AP_IK_ALARM_FLAG) {
034c ---- 0894                                                     ld          R0, [#analyseIk/state/IKstate]
034d ---- 8c02                                                     tst         R0, #2
034e ---- be09                                                     bnz         /id0639
               ;?                                 state.PirPulseCounter += 1;
034f ---- 0898                                                         ld          R0, [#analyseIk/state/PirPulseCounter]
0350 ---- 8801                                                         add         R0, #1
0351 ---- 0c98                                                         st          R0, [#analyseIk/state/PirPulseCounter]
               ;?                                 if (input.isTestMode == 1) {
0352 ---- 0889                                                         ld          R0, [#analyseIk/input/isTestMode]
0353 ---- 8a01                                                         cmp         R0, #1
0354 ---- be03                                                         bneq        /id0643
               ;?                                     fwGenAlertInterrupt();
0355 ---- 0876                                                             ld          R0, [#fwCtrlInt/bvTaskIoAlert]
0356 ---- 8201                                                             or          R0, #(1 << 0)
0357 ---- 0c76                                                             st          R0, [#fwCtrlInt/bvTaskIoAlert]
               ;?                                 }
               /id0643:
               ;?                             }
               /id0639:
               ;?                             state.idledowntimer = PIR_IDLE_PERIOD;
0358 ---- 0190                                                     ld          R0, #400
0359 ---- 0cc0                                                     st          R0, [#analyseIk/state/idledowntimer]
               ;?                             state.idledowntimerrun = 1;
035a ---- 0001                                                     ld          R0, #1
035b ---- 0cc1                                                     st          R0, [#analyseIk/state/idledowntimerrun]
               ;?                             state.PirPulsePresense = 1;
035c ---- 0001                                                     ld          R0, #1
035d ---- 0c99                                                     st          R0, [#analyseIk/state/PirPulsePresense]
               ;?                         }
               /id0637:
               ;?                     }
               /id0635:
               ;?                     state.maxUh = state.absdU;
035e ---- 08b8                                             ld          R0, [#analyseIk/state/absdU]
035f ---- 0cc4                                             st          R0, [#analyseIk/state/maxUh]
               ;?                     state.maxUl = 0;
0360 ---- 0000                                             ld          R0, #0
0361 ---- 0cc5                                             st          R0, [#analyseIk/state/maxUl]
               ;?                 } else {
0362 ---- 076e                                         jmp         /id0633
               /id0631:
               ;?                     if (state.absdU > state.maxUh) {
0363 ---- 08b8                                             ld          R0, [#analyseIk/state/absdU]
0364 ---- 18c4                                             ld          R1, [#analyseIk/state/maxUh]
0365 ---- 8d29                                             cmp         R0, R1
0366 ---- 9e07                                             bleu        /id0651
               ;?                         if (state.PirPulsePresense == 1) {
0367 ---- 0899                                                 ld          R0, [#analyseIk/state/PirPulsePresense]
0368 ---- 8a01                                                 cmp         R0, #1
0369 ---- be04                                                 bneq        /id0654
               ;?                             state.maxUh = state.absdU;
036a ---- 08b8                                                     ld          R0, [#analyseIk/state/absdU]
036b ---- 0cc4                                                     st          R0, [#analyseIk/state/maxUh]
               ;?                             state.maxUl = 0;
036c ---- 0000                                                     ld          R0, #0
036d ---- 0cc5                                                     st          R0, [#analyseIk/state/maxUl]
               ;?                         }
               /id0654:
               ;?                     }
               /id0651:
               ;?                 }
               /id0633:
               ;?             } else {
036e ---- 07a4                                     jmp         /id0622
               /id0620:
               ;?                 // state.deltaU < 0
               ;?                 condition = 0;
036f ---- 0000                                         ld          R0, #0
               ;?                 if (state.Upiri < state.Upl) {
0370 ---- 18a3                                         ld          R1, [#analyseIk/state/Upiri]
0371 ---- 28a6                                         ld          R2, [#analyseIk/state/Upl]
0372 ---- 9d2a                                         cmp         R1, R2
0373 ---- a605                                         bgeu        /id0659
               ;?                     if (state.Upiri1 >= state.Upl) {
0374 ---- 18a4                                             ld          R1, [#analyseIk/state/Upiri1]
0375 ---- 28a6                                             ld          R2, [#analyseIk/state/Upl]
0376 ---- 9d2a                                             cmp         R1, R2
0377 ---- ae01                                             bltu        /id0662
               ;?                         condition = 1;
0378 ---- 0001                                                 ld          R0, #1
               ;?                     }
               /id0662:
               ;?                 }
               /id0659:
               ;?                 if (condition == 1) {
0379 ---- 8a01                                         cmp         R0, #1
037a ---- be1e                                         bneq        /id0666
               ;?                     condition = 0;
               ;?                     if (state.maxslope < PIR_SLOPE_THRESHOLD) {
037b ---- 08c6                                             ld          R0, [#analyseIk/state/maxslope]
037c 8603 8ac0                                             cmp         R0, #960
037e ---- e615                                             bges        /id0670
               ;?                         if (state.PirPulsePresense == 0) {
037f ---- 0899                                                 ld          R0, [#analyseIk/state/PirPulsePresense]
0380 ---- 8a00                                                 cmp         R0, #0
0381 ---- be12                                                 bneq        /id0672
               ;?                             ifnot (state.IKstate & AP_IK_ALARM_FLAG) {
0382 ---- 0894                                                     ld          R0, [#analyseIk/state/IKstate]
0383 ---- 8c02                                                     tst         R0, #2
0384 ---- be09                                                     bnz         /id0674
               ;?                                 state.PirPulseCounter += 1;
0385 ---- 0898                                                         ld          R0, [#analyseIk/state/PirPulseCounter]
0386 ---- 8801                                                         add         R0, #1
0387 ---- 0c98                                                         st          R0, [#analyseIk/state/PirPulseCounter]
               ;?                                 if (input.isTestMode == 1) {
0388 ---- 0889                                                         ld          R0, [#analyseIk/input/isTestMode]
0389 ---- 8a01                                                         cmp         R0, #1
038a ---- be03                                                         bneq        /id0678
               ;?                                     fwGenAlertInterrupt();
038b ---- 0876                                                             ld          R0, [#fwCtrlInt/bvTaskIoAlert]
038c ---- 8201                                                             or          R0, #(1 << 0)
038d ---- 0c76                                                             st          R0, [#fwCtrlInt/bvTaskIoAlert]
               ;?                                 }
               /id0678:
               ;?                             }
               /id0674:
               ;?                             state.idledowntimer = PIR_IDLE_PERIOD;
038e ---- 0190                                                     ld          R0, #400
038f ---- 0cc0                                                     st          R0, [#analyseIk/state/idledowntimer]
               ;?                             state.idledowntimerrun = 1;
0390 ---- 0001                                                     ld          R0, #1
0391 ---- 0cc1                                                     st          R0, [#analyseIk/state/idledowntimerrun]
               ;?                             state.PirPulsePresense = 1;
0392 ---- 0001                                                     ld          R0, #1
0393 ---- 0c99                                                     st          R0, [#analyseIk/state/PirPulsePresense]
               ;?                         }
               /id0672:
               ;?                     }
               /id0670:
               ;?                     state.maxUl = state.absdU;
0394 ---- 08b8                                             ld          R0, [#analyseIk/state/absdU]
0395 ---- 0cc5                                             st          R0, [#analyseIk/state/maxUl]
               ;?                     state.maxUh = 0;
0396 ---- 0000                                             ld          R0, #0
0397 ---- 0cc4                                             st          R0, [#analyseIk/state/maxUh]
               ;?                 } else {
0398 ---- 07a4                                         jmp         /id0668
               /id0666:
               ;?                     if (state.absdU > state.maxUl) {
0399 ---- 08b8                                             ld          R0, [#analyseIk/state/absdU]
039a ---- 18c5                                             ld          R1, [#analyseIk/state/maxUl]
039b ---- 8d29                                             cmp         R0, R1
039c ---- 9e07                                             bleu        /id0686
               ;?                         if (state.PirPulsePresense == 1) {
039d ---- 0899                                                 ld          R0, [#analyseIk/state/PirPulsePresense]
039e ---- 8a01                                                 cmp         R0, #1
039f ---- be04                                                 bneq        /id0689
               ;?                             state.maxUl = state.absdU;
03a0 ---- 08b8                                                     ld          R0, [#analyseIk/state/absdU]
03a1 ---- 0cc5                                                     st          R0, [#analyseIk/state/maxUl]
               ;?                             state.maxUh = 0;
03a2 ---- 0000                                                     ld          R0, #0
03a3 ---- 0cc4                                                     st          R0, [#analyseIk/state/maxUh]
               ;?                         }
               /id0689:
               ;?                     }
               /id0686:
               ;?                 }
               /id0668:
               ;?             }
               /id0622:
               ;?         }
               /id0618:
               ;?     }
               /id0614:
               ;?     if (state.PirPulseCounter >= PIR_SENS) {
03a4 ---- 0898                             ld          R0, [#analyseIk/state/PirPulseCounter]
03a5 ---- 8a02                             cmp         R0, #2
03a6 ---- ee13                             blts        /id0693
               ;?         ifnot (state.IKstate & AP_IK_ALARM_FLAG) {
03a7 ---- 0894                                 ld          R0, [#analyseIk/state/IKstate]
03a8 ---- 8c02                                 tst         R0, #2
03a9 ---- be10                                 bnz         /id0695
               ;?             if (input.isTestMode != 0) {
03aa ---- 0889                                     ld          R0, [#analyseIk/input/isTestMode]
03ab ---- 8a00                                     cmp         R0, #0
03ac ---- b603                                     beq         /id0697
               ;?                 state.alarmdowntimer = 1;
03ad ---- 0001                                         ld          R0, #1
03ae ---- 0cbb                                         st          R0, [#analyseIk/state/alarmdowntimer]
               ;?             } else {
03af ---- 07b5                                     jmp         /id0699
               /id0697:
               ;?                 fwGenAlertInterrupt();
03b0 ---- 0876                                         ld          R0, [#fwCtrlInt/bvTaskIoAlert]
03b1 ---- 8201                                         or          R0, #(1 << 0)
03b2 ---- 0c76                                         st          R0, [#fwCtrlInt/bvTaskIoAlert]
               ;?                 state.alarmdowntimer = PIR_ALARM_TIME;
03b3 ---- 007d                                         ld          R0, #125
03b4 ---- 0cbb                                         st          R0, [#analyseIk/state/alarmdowntimer]
               ;?             }
               /id0699:
               ;?             state.alarmdowntimerrun = 1;
03b5 ---- 0001                                     ld          R0, #1
03b6 ---- 0cbc                                     st          R0, [#analyseIk/state/alarmdowntimerrun]
               ;?             state.IKstate |= AP_IK_ALARM_FLAG;
03b7 ---- 0894                                     ld          R0, [#analyseIk/state/IKstate]
03b8 ---- 8202                                     or          R0, #2
03b9 ---- 0c94                                     st          R0, [#analyseIk/state/IKstate]
               ;?         }
               /id0695:
               ;?     }
               /id0693:
               ;? }
               /id0389:
               /id0371:
               /id0322:
               ;? 
               ;? 
               ;? output.Upirav = state.Ucp;
03ba ---- 089d                         ld          R0, [#analyseIk/state/Ucp]
03bb ---- 0c8e                         st          R0, [#analyseIk/output/Upirav]
               ;? output.Uph = state.Uph;
03bc ---- 08a2                         ld          R0, [#analyseIk/state/Uph]
03bd ---- 0c8d                         st          R0, [#analyseIk/output/Uph]
               ;? output.Upl = state.Upl;
03be ---- 08a6                         ld          R0, [#analyseIk/state/Upl]
03bf ---- 0c90                         st          R0, [#analyseIk/output/Upl]
               ;? output.Uledi = state.Uledi;
03c0 ---- 089e                         ld          R0, [#analyseIk/state/Uledi]
03c1 ---- 0c8c                         st          R0, [#analyseIk/output/Uledi]
               ;? output.dUled = state.dUled;
03c2 ---- 08bd                         ld          R0, [#analyseIk/state/dUled]
03c3 ---- 0c91                         st          R0, [#analyseIk/output/dUled]
               ;? output.LightThrCounter10 = state.LightThrCounter << 3;
03c4 ---- 0895                         ld          R0, [#analyseIk/state/LightThrCounter]
03c5 ---- 8da3                         lsl         R0, #3
03c6 ---- 0c8a                         st          R0, [#analyseIk/output/LightThrCounter10]
               ;? output.LightThrCounter10 += state.LightThrCounter << 1;
03c7 ---- 1895                         ld          R1, [#analyseIk/state/LightThrCounter]
03c8 ---- 9da1                         lsl         R1, #1
03c9 ---- 088a                         ld          R0, [#analyseIk/output/LightThrCounter10]
03ca ---- 8d21                         add         R0, R1
03cb ---- 0c8a                         st          R0, [#analyseIk/output/LightThrCounter10]
               ;? output.PirPulseCounter = state.PirPulseCounter;
03cc ---- 0898                         ld          R0, [#analyseIk/state/PirPulseCounter]
03cd ---- 0c8b                         st          R0, [#analyseIk/output/PirPulseCounter]
               ;? 
               ;? 
               ;? if (input.isLogMode == 1) {
03ce ---- 0888                         ld          R0, [#analyseIk/input/isLogMode]
03cf ---- 8a01                         cmp         R0, #1
03d0 ---- be05                         bneq        /id0717
               ;?     fwGenAlertInterrupt();
03d1 ---- 0876                             ld          R0, [#fwCtrlInt/bvTaskIoAlert]
03d2 ---- 8201                             or          R0, #(1 << 0)
03d3 ---- 0c76                             st          R0, [#fwCtrlInt/bvTaskIoAlert]
               ;?     input.count = 0;
03d4 ---- 0000                             ld          R0, #0
03d5 ---- 0c86                             st          R0, [#analyseIk/input/count]
               ;? }
               /id0717:
               ;? 
               ;? // Schedule the next execution
               ;? fwScheduleTask(1);
03d6 ---- 0001                         ld          R0, #1
03d7 ---- 0c6f                         st          R0, [#(pFwTaskExecuteScheduleTable + 0)]
               ;? 
               ;? // Run-time logging: Log the output data structure
               ;? rtlLogStructs(BV_RTL_LOG_OUTPUT);
03d8 ---- 0004                         ld          R0, #4
03d9 ---- 1874                         ld          R1, [#(pRtlTaskLogMaskTable + 0)]
03da ---- 8d01                         and         R0, R1
03db ---- 0c73                         st          R0, [#(pRtlTaskLogReqTable + 0)]
               analyseIk/executeDone:
03dc ---- adb7                         rts         
                                       
                                       
                                       
                                       
               analyseIk/terminate:
               analyseIk/terminateDone:
03dd ---- adb7                         rts         
               .segment end "Task: AnalyseIK"
               
               
               .segment begin "Procedure Libary"
               ; PARAMETERS:
               ;     R7 = AUX I/O index (0-7)
               ;
               ; CLOBBERS:
               ;     R6, R7
               AdccompbSelectGpioInput:
                                       ; Make sure that the AUX I/O index is valid
03de ---- f007                         and         R7, #0x0007
               
                                       ; Disconnect all signals
03df ---- 146a                         jsr         AdiDdiAcquire
03e0 86ff 63f8                         ld          R6, #(BV_ADI16_MUX2_ADCCOMPB_IN | BV_ADI16_MUX3_ADCCOMPB_IN)
03e2 ---- eb51                         out         R6, [#IOP_ADICLR_MUX2_MUX3]
               
                                       ; Connect the specified GPIO
03e3 8680 6000                         ld          R6, #ADI16_MUX3_ADCCOMPB_IN_AUXIO0
03e5 ---- ed8f                         lsr         R6, R7
03e6 ---- eb49                         out         R6, [#IOP_ADISET_MUX2_MUX3]
               
                                       ; Ensure that it has taken effect
03e7 ---- fd47                         nop         ; Workaround for back-to-back ADI/DDI accesses
03e8 ---- eb49                         out         R6, [#IOP_ADISET_MUX2_MUX3]
03e9 ---- 146d                         jsr         AdiDdiRelease
03ea ---- adb7                         rts
               
               
               
               
               ; 3 + 5 CPU cycles = 16 clock cycles = 0.66 microsecond are added to the specified delay (parameter
               ; loading and timer configuration)
               ;
               ; PARAMETERS:
               ;     R7 = Delay
               ;     R6 = Prescaler exponent
               ;
               ; CLOBBERS:
               ;     R6
               FwDelay:
                                       ; Set the delay
03eb ---- fb0c                         out         R7, [#IOP_TIMER01_T0TARGET]
               
                                       ; Configure the timer (from clock, single-mode, prescaler exponent = R6)
03ec ---- eda4                         lsl         R6, #4
03ed ---- eb09                         out         R6, [#IOP_TIMER01_T0CFG]
               
                                       ; Start the timer, wait for it to trigger, and stop it
03ee ---- 640b                         iobset      #0, [#IOP_TIMER01_T0CTL]
03ef ---- cdb1                         wev1        #WEVSEL_TIMER0
03f0 ---- adb7                         rts
               
               
               
               
               ; CLOBBERS:
               ;     R7
               AdcDisable:
                                       ; Disable the ADC reference
03f1 ---- 146a                         jsr         AdiDdiAcquire
03f2 ---- 7079                         ld          R7, #((ADI16_ADCREF_EN | ADI16_ADCREF_REF_ON_IDLE) | (ADI16_ADCREF_SRC | (ADI16_ADCREF_EXT | ADI16_ADCREF_IOMUX)))
03f3 ---- fb55                         out         R7, [#IOP_ADICLR_ADCREF]
               
                                       ; Assert reset and disable the ADC
03f4 ---- 71fb                         ld          R7, #((ADI16_ADC_EN | ADI16_ADC_RESET_N) | (BV_ADI16_ADC_SMPL_CYCLE_EXP | (BV_ADI16_ADC_SMPL_MODE | ADI16_ADC_SCALE_DIS)))
03f5 ---- fb54                         out         R7, [#IOP_ADICLR_ADC]
               
                                       ; Ensure that it has taken effect
03f6 ---- fd47                         nop         ; Workaround for back-to-back ADI/DDI accesses
03f7 ---- fb54                         out         R7, [#IOP_ADICLR_ADC]
03f8 ---- 146d                         jsr         AdiDdiRelease
               
                                       ; Disable the ADC clock (no need to wait since IOB_WUC_ADCCLKCTL_ACK goes low immediately)
03f9 ---- 4431                         iobclr      #IOB_WUC_ADCCLKCTL_REQ, [#IOP_WUC_ADCCLKCTL]
               
                                       ; Disable the ADC data interface
03fa ---- 4400                         iobclr      #0, [#IOP_ANAIF_ADCCTL]
               
03fb ---- adb7                         rts
               .segment end "Procedure Libary"
               

; Generated by ELESTA-25 at 2018-08-01 18:25:13.038
